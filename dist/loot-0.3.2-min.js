/*
 * loot.js 0.3.2 03-25-2013
 * copyright (c) 2013 Andrew Luetgers
 * you are free to distribute loot.js under the MIT license
 * https://github.com/andrewluetgers/loot
 */

(function(){function T(e){var t=m.lo,n=m.ob,r=typeof e;if(r===t.str)return r;if(r===t.und)return r;if(e===null)return t.nul;if(e.nodeType===b)return t.ele;switch(u.call(e)){case n.num:return e===e?t.num:t.nan;case n.boo:return t.boo;case n.arr:return t.arr;case n.dat:return t.dat;case n.reg:return t.reg;case n.fun:return t.fun;case n.arg:return t.arg}return B(e)?t.str:r}function k(e){return e===null}function L(e){return e!==e}function A(e){return e&&e.nodeType==b}function O(e){return e&&e.nodeType==w}function M(e){return e===Object(e)&&e.constructor!==String}function D(e){return e===!0||e===!1||u.call(e)==C.boo}function P(e){return typeof e===N.und}function H(e){return typeof e===N.fun}function B(e){return e&&e.constructor===String}function j(e){return u.call(e)===C.num}function F(e){return u.call(e)===C.dat}function I(e){return u.call(e)===C.reg}function q(e){return u.call(e)===E}function R(e){return u.call(e)===C.arg}function U(e){return"NodeList"in t&&e instanceof NodeList||typeof e.length=="number"&&e.item!=="undefined"}function W(e){if(!e||typeof e!="object"||e.nodeType||t===e)return!1;try{if(e.constructor&&!a.call(e,"constructor")&&!a.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(n){return!1}var r;for(r in e);return r===undefined||a.call(e,r)}function X(e){for(var t in e)return!1;return!0}function J(e){return B(e)?e.replace($,""):e}function K(e){var t=0;if(e.length==0)return t;for(x=0;x<e.length;x++)char=e.charCodeAt(x),t=(t<<5)-t+char,t&=t;return t}function Q(){}function G(e,t){var n,r;if(e.bind===v&&v)return v.apply(e,s.call(arguments,1));if(!H(e))throw new TypeError;return r=s.call(arguments,2),n=function(){if(this instanceof n){Q.prototype=e.prototype;var i=new Q,o=e.apply(i,r.concat(s.call(arguments)));return Object(o)===o?o:i}return e.apply(t,r.concat(s.call(arguments)))}}function Y(e,t,n){var r;return function(){var i=this,s=Ht(arguments),o=function(){r=null,n||e.apply(i,s)};n&&!r&&e.apply(i,s),clearTimeout(r),r=setTimeout(o,t)}}function Z(e){if(z(e)||B(e))return e.length===0;for(var t in e)if(et(e,t))return!1;return!0}function et(e,t){return a.call(e,t)}function tt(e){var t={};return each(_.flatten(s.call(arguments,1)),function(n){n in e&&(t[n]=e[n])}),t}function nt(e,t){if(e!==Object(e))throw new TypeError("Invalid object, expected an object or array.");var n=[];return t?ut(e,function(e){n.push(e)}):ut(e,function(e,t){n.push(t)}),n}function rt(e){return nt(e)}function it(e){return nt(e,!0)}function st(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=new Array(r);while(i<r)s[i++]=e,e+=n;return s}function ot(e){var t=[];for(var n=e.length>>>0;n--;)t[n]=e[n];return t}function at(e,t,n){return ut(e,t,n,!0)}function ft(e){return e}function lt(e){return dt(e,function(e){return e})}function ct(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(f&&e.reduce===f)return r&&(t=G(t,r)),i?e.reduce(t,n):e.reduce(t);ut(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)});if(!i)throw new TypeError("Reduce of empty array with no initial value");return n}function ht(e,t,n){var r;return mt(e,function(e,i,s){if(t.call(n,e,i,s))return r=e,!0}),r}function pt(e,t,n){var r=[];return e==null?r:l&&e.filter===l?e.filter(t,n):(z(e)?ut(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)}):(r={},ut(e,function(e,i,s){t.call(n,e,i,s)&&(r[i]=e)})),r)}function dt(e,t,n){var r;return e?(z(e)?(r=[],ut(e,function(e,i,s){t.call(n,e,i,s)||(r[r.length]=e)})):(r={},ut(e,function(e,i,s){t.call(n,e,i,s)||(r[i]=e)})),r):r}function vt(e,t,n){var r=!0;return e==null?r:c&&e.every===c?e.every(t,n):(ut(e,function(e,i,s){if(!(r=r&&t.call(n,e,i,s)))return ut.breaker}),r)}function mt(e,t,n){var r=!1;return e==null?r:h&&e.some===h?e.some(t,n):(ut(e,function(e,i,s){if(r=t.call(n,e,i,s))return"break"}),!!r)}function gt(e,t){var n=!1;return e==null?n:p&&e.indexOf===p?e.indexOf(t)!=-1:(n=mt(e,function(e){return e===t}),n)}function yt(e,t){var n=Ht(arguments,2);return at(e,function(e){return(H(t)?t||e:e[t]).apply(e,n)})}function bt(e,t){return at(e,function(e){return e[t]})}function wt(e,t,n){if(!t&&z(e)&&e[0]===+e[0])return Math.max.apply(Math,e);if(!t&&Z(e))return-Infinity;var r={computed:-Infinity};return ut(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>=r.computed&&(r={value:e,computed:o})}),r.value}function Et(e,t,n){if(!t&&z(e)&&e[0]===+e[0])return Math.min.apply(Math,e);if(!t&&Z(e))return Infinity;var r={computed:Infinity};return ut(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o<r.computed&&(r={value:e,computed:o})}),r.value}function St(e){var t=[],n;return ut(e,function(e,r,i){n=Math.floor(Math.random()*(r+1)),t[r]=t[n],t[n]=e}),t}function xt(e){return H(e)?e:function(t){return t[e]}}function Tt(e,t,n,r){var i=xt(t),s;return r=r||function(e,t){if(e!==t){if(e>t||e===void 0)return 1;if(e<t||t===void 0)return-1}},bt(at(e,function(e,t,r){return{value:e,index:t,criteria:i.call(n,e,t,r)}}).sort(function(e,t){return s=r(e.criteria,t.criteria),s!==undefined?s:e.index<t.index?-1:1}),"value")}function Nt(e,t){var n=/(^-?[0-9]+(\.?[0-9]*)[df]?e?[0-9]?$|^0x[0-9a-f]+$|[0-9]+)/gi,r=/(^[ ]*|[ ]*$)/g,i=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,s=/^0x[0-9a-f]+$/i,o=/^0/,u=function(e){return Nt.insensitive&&(""+e).toLowerCase()||""+e},a=u(e).replace(r,"")||"",f=u(t).replace(r,"")||"",l=a.replace(n,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),c=f.replace(n,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),h=parseInt(a.match(s))||l.length!=1&&a.match(i)&&Date.parse(a),p=parseInt(f.match(s))||h&&f.match(i)&&Date.parse(f)||null,d,v;if(p){if(h<p)return-1;if(h>p)return 1}for(var m=0,g=Math.max(l.length,c.length);m<g;m++){d=!(l[m]||"").match(o)&&parseFloat(l[m])||l[m]||0,v=!(c[m]||"").match(o)&&parseFloat(c[m])||c[m]||0;if(isNaN(d)!==isNaN(v))return isNaN(d)?1:-1;typeof d!=typeof v&&(d+="",v+="");if(d<v)return-1;if(d>v)return 1}return 0}function kt(e,t,n){return Ct(e,t,n,function(e,t,n){(et(e,t)?e[t]:e[t]=[]).push(n)})}function Lt(e,t,n){return Ct(e,t,n,function(e,t,n){et(e,t)||(e[t]=0),e[t]++})}function At(e,t,n){n||(n=$identity);var r=0,i=e.length;while(r<i){var s=r+i>>1;n(e[s])<n(t)?r=s+1:i=s}return r}function Ot(e){var t=e&&e.length;return j(t)||(t=0,ut(e,function(){t++})),t}function Mt(e,t){return t=t>0&&j(t)?t:1,at(e,function(e){return t-->0?e:"break"})}function _t(e,t){t=t>0&&j(t)?t:1;var n=0,r=Ot(e),i=r<t?0:r-t;return at(e,function(e){return n++<i?"continue":e})}function Dt(e){return pt(e,function(e){return!!e||j(e)})}function Pt(){var e=n.concat.apply(n,arguments);return mt(e,z)?Pt.apply(this,e):e}function Ht(e,t,n){return s.call(e,t||0,n)}function Bt(e,t,n){return arguments.length>3||typeof e=="string"?o.apply(e,Pt(Ht(arguments,1))):o.call(e,t,n)}function jt(e,t){z(e)&&(e.length=0);for(var n in e)e.hasOwnProperty(n)&&(t?e[n]=null:delete e[n])}function Ft(e){var t=arguments.length===1&&z(e)?e:Ht(arguments),n=t.length,r=0,i,s=t.shift(),o=[],u,a;while(r<=n){for(var f=0;f<t.length;f++){u=t.shift(),r++;if(H(u)){i=u;break}o.push(u)}if(!s)break;a=s.apply(null,o),o=[a],s=i,i=null}return a}function It(){}function qt(e,t){It.prototype=e;var n=new It;return Gt(n,t)}function Rt(){var e=Ht(arguments),t=e.unshift();return ut(e,function(e){t=qt(t,e),H(e.init)&&t.init()}),t}function Ut(e,t){It.prototype=e||{};var n=new It;if(!t&&n.init)if(H(n.init))n.init();else{var r=pt(Pt(n.init),H);n.init=r.length>1?r:r[0],ut(r,function(e){e.call(n)})}return n}function zt(e,t,n,r){if(typeof e!="object"||k(e))throw new Error("traverse source must be an object");if(!H(t))throw new Error("traverse handler must be a function");var i,s={breadthFirst:[],depthFirst:[],siblings:[]};return Wt(e,t,-1,n,r,s),s.siblings=s.breadthFirst,s.breadthFirst=Pt(s.breadthFirst),n?i=s.breadthFirst:i=s.depthFirst,r&&(i=i.reverse()),ut(i,function(e){e.fn()}),s}function Wt(e,t,n,r,i,s){n++;var o,u,a=s.depthFirst,f=s.breadthFirst,l=[],c=[];f[n]?c=f[n]:f[n]=c;for(o in e)e.hasOwnProperty(o)&&(u=e[o],function(e,n,r){var i=function(){t(e,n,r)},s={val:e,key:n,depth:r,fn:i};a.push(s),l.push(s)}(u,o,n),typeof u=="object"&&!k(u)&&Wt(u,t,n,r,i,s));c.push(l),n--}function Xt(e,t,n){var r=m.lo.obj,i=typeof e===r;if(!i)return e;var s=typeof t===r,o=s&&z(t),u=z(e),a,f;s?o&&!u&&(t={}):t=u?[]:{};for(var l in e){a=e[l],f=t[l];if(n&&!n(l,e,t))continue;typeof a!==r||!a||a===t?t[l]=a:t[l]=Xt(a,f,n)}return t}function Vt(e,t){if(t&&!H(t))throw new Error("$copy: Optional second argument (filter) must be a function. Instead saw "+typeof t);var n=z(e)?[]:{};return Xt(e,n,t)}function $t(e){var t=arguments.length,n=Ht(arguments,1),r;if(t<2)throw new Error("$merge: a target and source are required and must be enumerable. Instead saw ("+typeof e+", "+typeof source+")");return H(arguments[t-1])&&(r=n.pop()),ut(n,function(t){Xt(t,e,r)}),e}function Qt(e){return e&&(Jt=[].concat(Ht(arguments,1)),ut(Jt,function(t){for(Kt in t)e[Kt]=t[Kt]})),e}function Gt(e){if(e){var t=Ht(arguments,1);ut(t,function(t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})}return e}function Yt(e,t,n){n=n||{};var r=Ut(e,!0),i=[].concat(r,t,n),s=[],o=!0,u;ut(i,function(e){var t=e?e.init:null;t&&s.push(t),s=pt(Pt(s),H),en(e)&&(u=!0)}),t&&Qt(r,t),n&&Gt(r,n),u&&Zt(r,o);var a=r.shareMessages;return a&&!r.dontShareMessages?(a===!0?(r.listensTo(e),r.listensTo(t)):a=="prototype"?r.listensTo(e):a=="extender"&&r.listensTo(t),r.shareMessages=!0):r.dontShareMessages&&r.shareMessages&&(r.shareMessages=!1),ut(s,function(e){e.call(r)}),r.init=s.length>1?s:s[0],r}function en(e){return!!(e&&H(e.tell)&&H(e.listen))}function tn(e){var t=e.listeners;en(e)||Zt(e),ut(t,function(t,n){H(t)||(t=e[t]),e.listen(n,t)})}function rn(e){var t=nn++;return e?e+t:t}var e="0.3.2",t=this;String.prototype.splice||(String.prototype.splice=function(e,t,n){var r=this.split("");return Array.prototype.splice.apply(r,arguments),r.join("")}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){"use strict";if(this==null)throw new TypeError;var t=Object(this),n=t.length>>>0;if(n===0)return-1;var r=0;arguments.length>0&&(r=Number(arguments[1]),r!=r?r=0:r!=0&&r!=Infinity&&r!=-Infinity&&(r=(r>0||-1)*Math.floor(Math.abs(r))));if(r>=n)return-1;var i=r>=0?r:Math.max(n-Math.abs(r),0);for(;i<n;i++)if(i in t&&t[i]===e)return i;return-1});var n=Array.prototype,r=Object.prototype,i=Function.prototype,s=n.slice,o=n.splice,u=r.toString,a=r.hasOwnProperty,f=n.reduce,l=n.filter,c=n.every,h=n.some,p=n.indexOf,d=Array.isArray,v=i.bind,m={lo:{},ob:{}},g="",y="",b=1,w=3,E="Error",S="Arguments Array Boolean Date Element Error Function Null Number Object RegExp String NaN Undefined".split(" ");for(var x=0;x<S.length;x++)g=S[x],y=g.toLowerCase(),m.lo[y.substr(0,3)]=y,m.ob[y.substr(0,3)]="[object "+g+"]";var N=m.lo,C=m.ob;R(arguments)||(R=function(e){return e&&et(e,"callee")});var z=d||function(e){return u.call(e)==C.arr},V=function(){function r(e,t,n){var r=T(e);if(r)return T(t[r])==="function"?t[r].apply(t,n):t[r]}var e,t=[],n=[],i=function(){function r(e,t){return e instanceof t.constructor||t instanceof e.constructor?t==e:t===e}return{string:r,"boolean":r,number:r,"null":r,"undefined":r,nan:function(e){return isNaN(e)},date:function(e,t){return F(e)&&t.valueOf()===e.valueOf()},regexp:function(e,t){return I(e)&&t.source===e.source&&t.global===e.global&&t.ignoreCase===e.ignoreCase&&t.multiline===e.multiline},"function":function(){var e=t[t.length-1];return e!==Object&&typeof e!="undefined"},array:function(t,r){var i,s,o,u;if(!z(t))return!1;u=r.length;if(u!==t.length)return!1;n.push(r);for(i=0;i<u;i++){o=!1;for(s=0;s<n.length;s++)n[s]===r[i]&&(o=!0);if(!o&&!e(r[i],t[i]))return n.pop(),!1}return n.pop(),!0},object:function(r,i){var s,o,u,a=!0,f=[],l=[];if(i.constructor!==r.constructor)return!1;t.push(i.constructor),n.push(i);for(s in i){u=!1;for(o=0;o<n.length;o++)n[o]===i[s]&&(u=!0);f.push(s);if(!u&&!e(i[s],r[s])){a=!1;break}}t.pop(),n.pop();for(s in r)l.push(s);return a&&e(f.sort(),l.sort())}}}();return e=function(){var e=Ht(arguments);return e.length<2?!0:function(e,t){return e===t?!0:e===null||t===null||typeof e=="undefined"||typeof t=="undefined"||T(e)!==T(t)?!1:r(e,i,[t,e])}(e[0],e[1])&&arguments.callee.apply(this,e.splice(1,e.length-1))},e}(),$=/^\s+|\s+$/g,ut=function(){function e(t,n,r,i){var s,o,u,f,l,c=e.break,h=e.continue;if(!t)return;typeof t=="number"&&(t=st(t));if(t.length===+t.length){f=U(t)?ot(t):t,i&&(o=[]);for(s=0;s<f.length;s++){l=n.call(r,f[s],s,f,o);if(l===h)continue;if(l===c)break;i&&(o[o.length]=l)}}else{i&&(o={});for(u in t)if(a.call(t,u)){l=n.call(r,t[u],u,t,o);if(l===h)continue;if(l===c)break;i&&(o[u]=l)}}return i?o:undefined}return e.break=e.breaker="break",e.continue=e.continuer="continue",e}(),xt=function(e){return H(e)?e:function(t){return t[e]}},Ct=function(e,t,n,r){var i={},s=xt(t);return ut(e,function(t,o){var u=s.call(n,t,o,e);r(i,u,t)}),i},Jt,Kt,Zt=function(){function r(e){if(e===t)throw new Error("cannot make js context root a speaker");return e&&e.hasOwnProperty("_listeningFor")&&e.hasOwnProperty("_audience")?e:(e?e=Qt(e,n):e=Ut(n),e._listeningFor={},e._audience=[],e)}var e=/^\/(.+)\/([ig]*)$/,n={tell:function(e,t,n){if(typeof e!="string")throw new TypeError("expected string but saw "+e);var r,i,s,o,u,a,f,l,c=this._audience,h=n||this,p=this.selectiveHearing;if(!p||H(p)&&this.selectiveHearing(t,e,h)){f=e!=="*"?this._listeningFor[e]||[]:[],u=pt(this._listeningFor._regexp,function(t){return e.match(t.regexp)}),a=this._listeningFor["*"],l=u?f.concat(u):f,l=a?l.concat(a):l;for(r=0,i=l.length;r<i;r++)s=l[r],o=s.maxResponses,s.responses++,o&&s.responses>=o&&this.ignore(s),s.responder.call(this,t,e,h);for(r=0,i=c.length;r<i;r++)c[r].tell(e,t,h)}return this},listen:function(t,n,r){var i=this,s=typeof t,o=s==="string",u=(t+"").match(e),a=u?"_regexp":t,f,l=!1,c=typeof n,h=c==="function";t=o&&u?new RegExp(u[1],u[2]):t;if(arguments.length>1){if(r&&!j(r))throw new Error("Invalid parameter: expected a number but saw "+typeof r);if(!h||!o&&!u)throw console.log(arguments),new Error("Invalid parameters, expected: (string, function) but saw ("+s+", "+c+")");var p=this._listeningFor[a]||[];ut(p,function(e){if(e.responder===n)return l=!0,ut.break}),l||(f={responder:n,responses:0,maxResponses:r,regexp:u?t:null},p.push(f),this._listeningFor[a]=p)}else s==="object"&&ut(t,function(e,t){if(!H(e))throw new Error("Invalid parameters, expected: (string, function) but saw ("+T(t)+", "+T(e)+")");i.listen(t,e)});return this},once:function(e,t){this.listen(e,t,1)},listenUntil:function(e,t,n){function r(){var i=Ht(arguments);n.apply(this,i)?this.ignore(e,r):t.apply(this,i)}this.listen(e,r)},listeningFor:function(e,t){if(e){var n={},r=e!=="*"?this._listeningFor[e]||[]:[];Ot(r)&&(n[e]=r);var i=pt(this._listeningFor._regexp,function(t){return e&&e.match(t.regexp)});Ot(i)&&(n._regexp=i);var s=this._listeningFor["*"];return!t&&s&&s.length&&(n["*"]=i),n}return this._listeningFor},ignore:function(t,n){var r,i=H(n),s=typeof t=="string",o=(t+"").match(e);return t?o?(i?r=function(e){return e.responder+""==t+""&&e.responder===n}:r=function(e){return e.regexp+""==t+""},this._listeningFor._regexp=dt(this._listeningFor._regexp,r)):s?i?this._listeningFor[t]=dt(this._listeningFor[t],function(e){return e.responder===n}):delete this._listeningFor[t]:typeof t=="function"&&(this._listeningFor=at(this._listeningFor,function(e){return dt(e,function(e){return e.responder===t})})):jt(this._listeningFor),this},talksTo:function(e){return this!==e&&this._audience.indexOf(e)===-1&&this._audience.push(Zt(e)),this},listensTo:function(e){return en(e)&&e._audience.indexOf(this)===-1&&e!==this&&e._audience.push(this),this}};return r}(),nn=0,sn,on=!1,un=function(e){un.fn(e)};un.version=e,un.fn=function(e){var t=!1;e?sn=e:(t=!0,sn={});var n={};ut(this.exports,function(e,t){var r=sn[t];r&&(n[t]=r),sn[t]=e}),this.oldValues=n,on=!0;if(t)return sn},un.exports={$isNull:k,$isNaN:L,$isElement:A,$isTextNode:O,$isObject:M,$isPlainObject:W,$isEmptyObject:X,$isBoolean:D,$isUndefined:P,$isFunction:H,$isString:B,$isNumber:j,$isDate:F,$isRegExp:I,$isArguments:R,$isNodeList:U,$isArray:z,$isError:q,$typeof:T,$same:V,$trim:J,$hashCode:K,$bind:G,$debounce:Y,$each:ut,$for:ut,$map:at,$range:st,$reduce:ct,$find:ht,$filter:pt,$reject:dt,$every:vt,$all:vt,$any:mt,$maybe:lt,$includes:gt,$contains:gt,$invoke:yt,$ex:Ft,$pluck:bt,$value:ft,$max:wt,$min:Et,$shuffle:St,$sortBy:Tt,$naturalSort:Nt,$groupBy:kt,$countBy:Lt,$sortedIndex:At,$size:Ot,$length:Ot,$head:Mt,$tail:_t,$compact:Dt,$flat:Pt,$slice:Ht,$splice:Bt,$clear:jt,$hasOwnProperty:a,$isEmpty:Z,$has:et,$pick:tt,$keys:rt,$values:it,$vals:it,$new:Ut,$create:Rt,$walk:zt,$copy:Vt,$merge:$t,$extend:Qt,$mixin:Gt,$make:Yt,$speak:Zt,$isSpeaker:en,$bindListenerSpec:tn,$uniqueId:rn},un.addExport=function(e,t){if(this.exports[e])throw new Error("loot.addExport: "+e+" is already taken.");this.exports[e]=t,sn&&sn[e]&&(this.oldValues[e]=sn[e]),on&&(sn[e]=t)},un.extend=function(e,t){if(typeof e=="string")this.addExport(e,t);else if(arguments.length==1&&typeof arguments[0]=="object"){t=arguments[0];for(e in t)this.addExport(e,t[e])}},this.loot&&(un.oldLoot=this.loot),this.loot=un,un(this)})(),function(){function t(e){try{return JSON&&JSON.parse?JSON.parse(e):(new Function("return "+e))()}catch(t){r("ijs",t.message)}}function r(e,t){throw new Error(n[e]+(t&&" in '"+t+"'"))}function u(e,n){n||(n=0);var o=s.exec(e.substr(n));if(!o)return undefined;n+=o[0].length;var u;return o[1]?u=[n," "]:o[2]?u=[n,o[0]]:o[3]?u=[n,i.typ,o[0]]:o[4]?u=[n,i.psc,o[0]]:o[5]?u=[n,i.psf,o[0]]:o[6]?r("upc",e):o[8]?u=[n,o[7]?i.ide:i.str,t(o[8])]:o[9]?r("ujs",e):o[10]&&(u=[n,i.ide,o[10].replace(/\\([^\r\n\f0-9a-fA-F])/g,"$1")]),u}function f(e,t){return typeof e===t}function c(e,n){var r,i=a.exec(e.substr(n));if(i)return n+=i[0].length,r=i[1]||i[2]||i[3]||i[5]||i[6],i[1]||i[2]||i[3]?[n,0,t(r)]:i[4]?[n,0,undefined]:[n,r]}function h(e,t){t||(t=0);var n=c(e,t),i;if(n&&n[1]==="("){i=h(e,n[0]);var s=c(e,i[0]);(!s||s[1]!==")")&&r("epex",e),t=s[0],i=["(",i[1]]}else!n||n[1]&&n[1]!="x"?r("ee",e+" - "+(n[1]&&n[1])):(i=n[1]==="x"?undefined:n[2],t=n[0]);var o=c(e,t);if(!o||o[1]==")")return[t,i];(o[1]=="x"||!o[1])&&r("bop",e+" - "+(o[1]&&o[1]));var u=h(e,o[0]);t=u[0],u=u[1];var a;if(typeof u!="object"||u[0]==="("||l[o[1]][0]<l[u[1]][0])a=[i,o[1],u];else{a=u;while(typeof u[0]=="object"&&u[0][0]!="("&&l[o[1]][0]>=l[u[0][1]][0])u=u[0];u[0]=[i,o[1],u[0]]}return[t,a]}function p(e,t){function n(e){return typeof e!="object"||e===null?e:e[0]==="("?n(e[1]):[n(e[0]),e[1],n(e[2])]}var r=h(e,t?t:0);return[r[0],n(r[1])]}function d(e,t){if(e===undefined)return t;if(e===null||typeof e!="object")return e;var n=d(e[0],t),r=d(e[2],t);return l[e[1]][1](n,r)}function v(e,t,n,i){n||(i={});var s=[],o,a;t||(t=0);for(;;){var f=y(e,t,i);s.push(f[1]),f=u(e,t=f[0]),f&&f[1]===" "&&(f=u(e,t=f[0]));if(!f)break;if(f[1]===">"||f[1]==="~")f[1]==="~"&&(i.usesSiblingOp=!0),s.push(f[1]),t=f[0];else if(f[1]===",")o===undefined?o=[",",s]:o.push(s),s=[],t=f[0];else if(f[1]===")"){n||r("ucp",f[1]),a=1,t=f[0];break}}n&&!a&&r("mcp",e),o&&o.push(s);var l;return!n&&i.usesSiblingOp?l=g(o?o:s):l=o?o:s,[t,l]}function m(e){var t=[],n;for(var r=0;r<e.length;r++)if(e[r]==="~"){if(r<2||e[r-2]!=">")n=e.slice(0,r-1),n=n.concat([{has:[[{pc:":root"},">",e[r-1]]]},">"]),n=n.concat(e.slice(r+1)),t.push(n);if(r>1){var i=e[r-2]===">"?r-3:r-2;n=e.slice(0,i);var s={};for(var o in e[i])e[i].hasOwnProperty(o)&&(s[o]=e[i][o]);s.has||(s.has=[]),s.has.push([{pc:":root"},">",e[r-1]]),n=n.concat(s,">",e.slice(r+1)),t.push(n)}break}return r==e.length?e:t.length>1?[","].concat(t):t[0]}function g(e){if(e[0]===","){var t=[","];for(var n=n;n<e.length;n++){var r=m(r[n]);t=t.concat(r[0]===","?r.slice(1):r)}return t}return m(e)}function y(e,t,n){var s=t,a={},f=u(e,t);f&&f[1]===" "&&(s=t=f[0],f=u(e,t)),f&&f[1]===i.typ?(a.type=f[2],f=u(e,t=f[0])):f&&f[1]==="*"&&(f=u(e,t=f[0]));for(;;){if(f===undefined)break;if(f[1]===i.ide)a.id&&r("nmi",f[1]),a.id=f[2];else if(f[1]===i.psc)(a.pc||a.pf)&&r("mpc",f[1]),f[2]===":first-child"?(a.pf=":nth-child",a.a=0,a.b=1):f[2]===":last-child"?(a.pf=":nth-last-child",a.a=0,a.b=1):a.pc=f[2];else{if(f[1]!==i.psf)break;if(f[2]===":val"||f[2]===":contains")a.expr=[undefined,f[2]===":val"?"=":"*=",undefined],f=u(e,t=f[0]),f&&f[1]===" "&&(f=u(e,t=f[0])),(!f||f[1]!=="(")&&r("pex",e),f=u(e,t=f[0]),f&&f[1]===" "&&(f=u(e,t=f[0])),(!f||f[1]!==i.str)&&r("sex",e),a.expr[2]=f[2],f=u(e,t=f[0]),f&&f[1]===" "&&(f=u(e,t=f[0])),(!f||f[1]!==")")&&r("epex",e);else if(f[2]===":has"){f=u(e,t=f[0]),f&&f[1]===" "&&(f=u(e,t=f[0])),(!f||f[1]!=="(")&&r("pex",e);var l=v(e,f[0],!0);f[0]=l[0],a.has||(a.has=[]),a.has.push(l[1])}else if(f[2]===":expr"){a.expr&&r("mexp",e);var c=p(e,f[0]);f[0]=c[0],a.expr=c[1]}else{(a.pc||a.pf)&&r("mpc",e),a.pf=f[2];var h=o.exec(e.substr(f[0]));h||r("mepf",e),h[5]?(a.a=2,a.b=h[5]==="odd"?1:0):h[6]?(a.a=0,a.b=parseInt(h[6],10)):(a.a=parseInt((h[1]?h[1]:"+")+(h[2]?h[2]:"1"),10),a.b=h[3]?parseInt(h[3]+h[4],10):0),f[0]+=h[0].length}}f=u(e,t=f[0])}return s===t&&r("se",e),[t,a]}function b(t){return Array.isArray?Array.isArray(t):e.call(t)==="[object Array]"}function w(e){if(e===null)return"null";var t=typeof e;return t==="object"&&b(e)&&(t="array"),t}function E(e,t,n,r,i){var s=[],o=t[0]===">"?t[1]:t[0],u=!0,a;o.type&&(u=u&&o.type===w(e)),o.id&&(u=u&&o.id===n),u&&o.pf&&(o.pf===":nth-last-child"?r=i-r:r++,o.a===0?u=o.b===r:(a=(r-o.b)%o.a,u=!a&&r*o.a+o.b>=0));if(u&&o.has){var f=function(){throw 42};for(var l=0;l<o.has.length;l++){try{S(o.has[l],e,f)}catch(c){if(c===42)continue}u=!1;break}}return u&&o.expr&&(u=d(o.expr,e)),t[0]!==">"&&t[0].pc!==":root"&&s.push(t),u&&(t[0]===">"?t.length>2&&(u=!1,s.push(t.slice(2))):t.length>1&&(u=!1,s.push(t.slice(1)))),[u,s]}function S(e,t,n,r,i,s){var o=e[0]===","?e.slice(1):[e],u=[],a=!1,f=0,l=0,c,h;for(f=0;f<o.length;f++){h=E(t,o[f],r,i,s),h[0]&&(a=!0);for(l=0;l<h[1].length;l++)u.push(h[1][l])}if(u.length&&typeof t=="object"){u.length>=1&&u.unshift(",");if(b(t))for(f=0;f<t.length;f++)S(u,t[f],n,undefined,f,t.length);else for(c in t)t.hasOwnProperty(c)&&S(u,t[c],n,c)}a&&n&&n(t)}function x(e,t){var n=[];return S(e,t,function(e){n.push(e)}),n}function T(e,t){e=e.replace(/\?/g,function(){if(t.length===0)throw"too few parameters given";var e=t.shift();return typeof e=="string"?JSON.stringify(e):e});if(t.length)throw"too many parameters supplied";return e}function N(e,t){return t&&(e=T(e,t)),{sel:v(e)[1],match:function(e){return x(this.sel,e)},forEach:function(e,t){return S(this.sel,e,t)}}}function C(e,t){if(!$isString(e)){if($isString(t))return C.match(t,e);var n;return $map(e,function(e){return n=C(e,t),n.length>1?n:n[0]})}return C.match(e,t)}var e=Object.prototype.toString,n={bop:"binary operator expected",ee:"expression expected",epex:"closing paren expected ')'",ijs:"invalid json string",mcp:"missing closing paren",mepf:"malformed expression in pseudo-function",mexp:"multiple expressions not allowed",mpc:"multiple pseudo classes (:xxx) not allowed",nmi:"multiple ids not allowed",pex:"opening paren expected '('",se:"selector expected",sex:"string expected",sra:"string required after '.'",uc:"unrecognized char",ucp:"unexpected closing paren",ujs:"unclosed json string",upc:"unrecognized pseudo class"},i={psc:1,psf:2,typ:3,str:4,ide:5},s=new RegExp('^(?:([\\r\\n\\t\\ ]+)|([~*,>\\)\\(])|(string|boolean|null|array|object|number)|(:(?:root|first-child|last-child|only-child))|(:(?:nth-child|nth-last-child|has|expr|val|contains))|(:\\w+)|(?:(\\.)?(\\"(?:[^\\\\\\"]|\\\\[^\\"])*\\"))|(\\")|\\.((?:[_a-zA-Z]|[^\\0-\\0177]|\\\\[^\\r\\n\\f0-9a-fA-F])(?:[$_a-zA-Z0-9\\-]|[^\\u0000-\\u0177]|(?:\\\\[^\\r\\n\\f0-9a-fA-F]))*))'),o=/^\s*\(\s*(?:([+\-]?)([0-9]*)n\s*(?:([+\-])\s*([0-9]))?|(odd|even)|([+\-]?[0-9]+))\s*\)/,a=new RegExp('^\\s*(?:(true|false|null)|(-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?)|("(?:[^\\]|\\[^"])*")|(x)|(&&|\\|\\||[\\$\\^<>!\\*]=|[=+\\-*/%<>])|([\\(\\)]))'),l={"*":[9,function(e,t){return e*t}],"/":[9,function(e,t){return e/t}],"%":[9,function(e,t){return e%t}],"+":[7,function(e,t){return e+t}],"-":[7,function(e,t){return e-t}],"<=":[5,function(e,t){return f(e,"number")&&f(t,"number")&&e<=t||f(e,"string")&&f(t,"string")&&e<=t}],">=":[5,function(e,t){return f(e,"number")&&f(t,"number")&&e>=t||f(e,"string")&&f(t,"string")&&e>=t}],"$=":[5,function(e,t){return f(e,"string")&&f(t,"string")&&e.lastIndexOf(t)===e.length-t.length}],"^=":[5,function(e,t){return f(e,"string")&&f(t,"string")&&e.indexOf(t)===0}],"*=":[5,function(e,t){return f(e,"string")&&f(t,"string")&&e.indexOf(t)!==-1}],">":[5,function(e,t){return f(e,"number")&&f(t,"number")&&e>t||f(e,"string")&&f(t,"string")&&e>t}],"<":[5,function(e,t){return f(e,"number")&&f(t,"number")&&e<t||f(e,"string")&&f(t,"string")&&e<t}],"=":[3,function(e,t){return e===t}],"!=":[3,function(e,t){return e!==t}],"&&":[2,function(e,t){return e&&t}],"||":[1,function(e,t){return e||t}]};C._lex=u,C._parse=v,C.match=function(e,t,n){return n||(n=t,t=undefined),N(e,t).match(n)},C.forEach=function(e,t,n,r){return r||(r=n,n=t,t=undefined),N(e,t).forEach(n,r)},C.compile=N,loot.extend({$select:C})}(),function(){function e(){return(new Date).getTime()}function i(e){var t,n,r,i,s,o,u,a;i=Math.round(parseFloat(e)%1*1e3),r=parseInt(e,10),t=Math.floor(r/3600),r-=t*3600,n=Math.floor(r/60),r-=n*60,s=function(e){return e>9?e:"0"+e},o=$map([t,n],s).join(":"),u=$map([t,n,r],s).join(":");var f=t?t+" hour"+(t>1?"s ":" "):"",l=t||n?n+" minute"+(n>1?"s":""):"",c=!n&&r?r+" second"+(r>1?"s":""):"";return a=f+l+c,{h:t,m:n,s:r,ms:i,"hh:mm":o,"hh:mm:ss":u,formatted:a}}function s(e){return i(parseInt(e,10)/1e3)}var t=function(){function i(e){return[[60,e.now],[3600,e.minute,e.minutes,60],[86400,e.hour,e.hours,3600],[604800,e.day,e.days,86400],[2628e3,e.week,e.weeks,604800],[31536e3,e.month,e.months,2628e3],[Infinity,e.year,e.years,31536e3]]}function s(e,t){return e>=t&&e<=t*(1+r)?t:e}function o(e){switch(typeof e){case"string":e=new Date((""+e).replace(t,"/").replace(n," "));break;case"number":e=new Date(e)}return e}var t=/-/g,n=/[TZ]/g,r=.1,u=function(t,n,r){t=o(t||e()),n=o(n||new Date),r=r||this.defaultLang;var i=this.formats[r],u,a=typeof t=="string",f=(n-t+(n.getTimezoneOffset()-(a?0:t.getTimezoneOffset()))*6e4)/1e3;f<0?(f=Math.abs(f),u=""):u=" "+i.ago;for(var l=0,c=formats[0];formats[l];c=formats[++l])if(f<c[0]){if(l===0)return c[1];var h=Math.ceil(s(f,c[3])/c[3]);return h+" "+(h!=1?c[2]:c[1])+(l>0?u:"")}};return u.lang={},u.formats={},u.setLang=function(e,t){this.defaultLang=e,this.lang[e]=t,this.formats[e]=i(t)},u.setLang("en",{ago:"Ago",now:"Just Now",minute:"Minute",minutes:"Minutes",hour:"Hour",hours:"Hours",day:"Day",days:"Days",week:"Week",weeks:"Weeks",month:"Month",months:"Months",year:"Year",years:"Years"}),u}(),n=function(){var t=(new Date(1970,1,1,0,0,0,0)).valueOf(),n={parent:null,interval:null,started:0,elapsed:0,start:function(){var t=this;this.started=e(),this.interval=setInterval(function(){t.update()},1e3)},stop:function(){clearInterval(this.interval),this.reset()},pause:function(){clearInterval(this.interval)},reset:function(){this.started=e(),this.update()},update:function(){this.elapsed=e()-this.started,this.parent.innerHTML=this.format(this.elapsed+e()-this.started)},format:function(e){var n=(new Date(e+t)).toString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1"),r=e%1e3+"";while(r.length<3)r="0"+r;return n+="."+r,n.substr(0,n.length-4)}};return function(e){var t=$new(n);return t.parent=e,t}}(),r=function(){var e=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,t=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,n=/[^-+\dA-Z]/g,i=function(e,t){e=String(e),t=t||2;while(e.length<t)e="0"+e;return e};return function(s,o,u,a){if(!s)return s+"";var f=r;a=a||f.defaultLang;var l=f.lang[a];arguments.length==1&&Object.prototype.toString.call(s)=="[object String]"&&!/\d/.test(s)&&(o=s,s=undefined),s=s?new Date(s):new Date;if(!$isDate(s))throw SyntaxError("invalid date");o=String(f.masks[o]||o||f.masks["default"]),o.slice(0,4)=="UTC:"&&(o=o.slice(4),u=!0);var c=u?"getUTC":"get",h=s[c+"Date"](),p=s[c+"Day"](),d=s[c+"Month"](),v=s[c+"FullYear"](),m=s[c+"Hours"](),g=s[c+"Minutes"](),y=s[c+"Seconds"](),b=s[c+"Milliseconds"](),w=u?0:s.getTimezoneOffset(),E={d:h,dd:i(h),ddd:l.dayNames[p],dddd:l.dayNames[p+7],m:d+1,mm:i(d+1),mmm:l.monthNames[d],mmmm:l.monthNames[d+12],yy:String(v).slice(2),yyyy:v,h:m%12||12,hh:i(m%12||12),H:m,HH:i(m),M:g,MM:i(g),s:y,ss:i(y),l:i(b,3),L:i(b>99?Math.round(b/10):b),t:m<12?"a":"p",tt:m<12?"am":"pm",T:m<12?"A":"P",TT:m<12?"AM":"PM",Z:u?"UTC":(String(s).match(t)||[""]).pop().replace(n,""),o:(w>0?"-":"+")+i(Math.floor(Math.abs(w)/60)*100+Math.abs(w)%60,4),S:["th","st","nd","rd"][h%10>3?0:(h%100-h%10!=10)*h%10]};return o.replace(e,function(e){return e in E?E[e]:e.slice(1,e.length-1)})}}();r.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},r.defaultLang="en",r.lang={en:{dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]}},loot.extend({$now:e,$date:r,$timeAgo:t,$timer:n,$secondsToTime:i,$millisToTime:s})}(),function(){function i(t,n){var r=arguments.length,i=typeof n;$isFunction(t)&&(t=$slice(arguments),n=function(){});if($isArray(t)&&$isFunction(t[0])||$isPlainObject(t)&&$isFunction($values(t)[0]))e.tasks(t,n);else if(r!==2&&r!==3||i!=="function"){if(r!==4||i!=="number")throw new TypeError;e.eachLimit.apply(e,$slice(arguments))}else e.map.apply(e,$slice(arguments))}function s(t,n){$isFunction(t)&&(t=$slice(arguments),n=function(){}),$isArray(t)&&$isFunction(t[0])||$isPlainObject(t)&&$isFunction($values(t)[0])?e.tasksSeries(t,n):e.mapSeries(t,n,arguments[2])}function o(t,n){var r=0,i={tasks:[],concurrency:n,saturated:null,empty:null,drain:null,push:function(t,r){$isArray(t)||(t=[t]),e.each(t,function(t){i.tasks.push({data:t,callback:$isFunction(r)?r:null}),$isFunction(i.saturated)&&i.tasks.length==n&&i.saturated(),e.nextTick(i.process)})},process:function(){if(r<i.concurrency&&i.tasks.length){var e=i.tasks.shift();$isFunction(i.empty)&&i.tasks.length==0&&i.empty(),r+=1,t(function(){r-=1,e.callback&&e.callback.apply(e,arguments),$isFunction(i.drain)&&i.tasks.length+r==0&&i.drain(),i.process()},e.data)}},length:function(){return i.tasks.length},running:function(){return r}};return i}var e={each:function(e,t,n){var r=$length(e),i=0;n=n||function(){};if(!r)return n();$each(e,function(e,s,o){t(function(e){e?(n&&n(e,o),n=null):++i===r&&n&&n(null,o)},e,s,o)})},eachSeries:function(e,t,n){var r,i=$keys(e),s=0,o=i.length,u;n=n||function(){},r=function(){u=i[s],t(function(t){t?(n&&n(t,e),n=null):++s===o?n&&n(null,e):r()},e[u],u,e)},r()},eachLimit:function(e,t,n,r){function l(e){e?(r(e),r=function(){}):(u++,f--,console.log(">>>",u,o),u===o?r():c())}function c(){if(u===o||t<=0)return r();while(f<t&&a<o)a++,f++,n(l,i[a-1],s[a-1])}var i=$vals(e),s=$keys(e),o=$length(i),u=0,a=0,f=0;r=r||function(){},c()},nextTick:function(){return typeof process=="undefined"||!process.nextTick?function(e){setTimeout(e,0)}:process.nextTick}(),iterator:function(e){var t=function(n){var r=function(){return e.length&&e[n].apply(null,arguments),r.next()};return r.next=function(){return n<e.length-1?t(n+1):null},r};return t(0)}},t=function(t){return function(){var n=$slice(arguments);return t.apply(null,[e.each].concat(n))}},n=function(t){return function(){var n=$slice(arguments);return t.apply(null,[e.eachSeries].concat(n))}},r=function(e,t,n,r){r=r||function(){};var i=$isArray(t)?[]:{};e(t,function(e,t,r,s){n(function(t,n){i[r]=n,e(t)},t,r,i,s)},function(e){r(e,i,t)})};e.map=t(r),e.mapSeries=n(r),e.tasks=function(t,n){var r=function(e,t,n,r,i){if(!t||!$isFunction(t))throw new Error("expected a function but saw "+typeof t);t(e,r,n)};e.map(t,r,n)},e.tasksSeries=function(t,n){var r=function(e,t,n,r,i){if(!t||!$isFunction(t))throw new Error("expected a function but saw "+typeof t);t(e,n,r)};e.mapSeries(t,r,n)},loot.extend({$async:e,$parallel:i,$series:s,$queue:o})}(),function(){}(),function(){function n(e){return e&&e.bins&&e.get&&e.set}function r(e,t,n){}function i(e,t,n){}var e=loot.exports.$speak(function(n,r,i,s){var o=t.getKey(n,r),u=$isSpeaker(this)?this:e,a=u.typeId||"io",f=arguments[arguments.length-1],l=$isPlainObject(f)?f:{},c=l.start,h=l.success,p=l.error,d=a!=="io",v=d?t.get(a,n,r):null,m=$.ajax({dataType:$isString(i)?i:"json",type:$isString(s)?s:"GET",url:n,data:r,success:function(e,i,s){var o=d?t.set(a,n,r,e,{xhr:s}):{val:e,xhr:s,url:n,req:r};$isFunction(h)&&h.call(u,o,a+":success:"+n),u.tell(a+":success:"+n,o)},error:function(e,t,i){var s={status:t,key:o,error:i,req:r,xhr:e};d&&(s.bin=v,s.key=o),$isFunction(p)&&p.call(u,s,a+":error:"+n),u.tell(a+":error:"+n,s)}});return d&&(v.xhr=m),$isFunction(c)&&c.call(u,v,a+":start:"+n),u.tell(a+":start:"+n,v),v}),t=$speak({types:{io:{bins:{}}},getKey:function(e,t){if(!t)return e;var n=[],r=[],i={};return $each(t,function(e,t){r.push(t);var n=$isString(e)||$isNumber(e)?e:e+"";i[t]=t+":"+n}),$each(r.sort(),function(e){n.push(i[e])}),e+"["+n.join(",")+"]"},get:function(e,t,n,r){var i=arguments.length;if(!i)return this.types;if(e){var s=this.types[e];if(i===1)return s;if(n){var o=this.getKey(n,r),u=s.bins;return o in u||(u[o]={typeId:e,key:o,url:n,req:r,val:null,setAt:$now()}),u[o]}}throw new Error("$cache.get: invalid arguments")},evict:function(e,t){var n=0;return total=0,that=this,$each(this.types[e].bins,function(r,i){total++;if(!t||t===!0||$isFunction(t)&&t(r,i))n++,that.tell(e+":evict:"+i,r),delete that.types[e].bins[i]}),{evicted:n,total:total,remain:total-n}},set:function(e,t,n,r,i){var s=this.getKey(t,n),o=this.get(e,s);return $extend(o,{typeId:e,key:s,url:t,req:n,val:r,setAt:$now()},i),this.tell(e+":set:"+s,o),o},newType:function(e,t){this.types[e]||(t=t||{},t.bins={},this.types[e]=t)},newRemoteType:function(n,r){r.sync=function(n,r,i){var s=t.get(this.typeId,this.baseUrl,n);return(i||s.val===null||s.ttl&&$now()-s.set>this.ttl)&&e.call(this,baseUrl,n,this.dataType,this.reqType,r),s},r.typeId=n;var i=$speak(r);return this.newType(n,i),i}});$space=function(){var e={};return function(t,n){var r=arguments.length,i=e[t];if(!r)return e;if(r===1)return i;if(r&&!i)return i={},i}}(),loot.extend({$io:e,$cache:t,$isCache:n,$space:$space,$set:r,$get:i})}(),function(){function $id(e){return document.getElementById(e)}function $part(e,t){if(arguments.length===0)return parts;if(!$isString(e))throw new TypeError("Expected string for name but saw "+$typeof(e));if(!(e in parts)){if($isFunction(t))return parts[e]=t;throw new Error("No such partial '"+e+"', expected a function but saw "+$typeof(t))}if(!t)return parts[e];if($isFunction(t))return parts[e]=t;if($isObject(t))return function(n){return parts[e](n||t)}}function $render(e,t){return $parts(e)(t).toString()}function $js(e){var t,n={type:"text/javascript"};if($isFunction(e)){var r=e.toString();r=r.substring(r.indexOf("{")+1,r.lastIndexOf("}")),t=$el("script",n,r),console.log("----------",t,r)}else $isString(e)?e.match(jsre)?(n.src=e,t=$el("script",n)):t=$el("script",n,e):$isPlainObject(e)&&(t=$el("script",$mixin(n,e)));return t}function touchToMouse(e){if(e.touches.length>1)return;var t=e.changedTouches[0],n="";switch(e.type){case"touchstart":n="mousedown";break;case"touchmove":n="mousemove";break;case"touchend":n="mouseup";break;default:return}var r=document.createEvent("MouseEvent");r.initMouseEvent(n,!0,!0,window,1,t.screenX,t.screenY,t.clientX,t.clientY,!1,!1,!1,!1,0,null),t.target.dispatchEvent(r),e.preventDefault()}function $touchable(e){e.ontouchstart=touchToMouse,e.ontouchmove=touchToMouse,e.ontouchend=touchToMouse}var root=this,$tmpl=function(){function resolveDefs(c,block,def){return(typeof block=="string"?block:block.toString()).replace(c.define,function(match,code,assign,value){return code.indexOf("def.")===0&&(code=code.substring(4)),code in def||(assign===":"?def[code]=value:eval("def[code]="+value)),""}).replace(c.use,function(match,code){var v=eval(code);return v?resolveDefs(c,v,def):v})}var doT={version:"0.1.7"};return doT.templateSettings={evaluate:/\{\{([\s\S]+?)\}\}/g,interpolate:/\{\{=([\s\S]+?)\}\}/g,encode:/\{\{!([\s\S]+?)\}\}/g,use:/\{\{#([\s\S]+?)\}\}/g,define:/\{\{##\s*([\w\.$]+)\s*(\:|=)([\s\S]+?)#\}\}/g,conditionalStart:/\{\{\?([\s\S]+?)\}\}/g,conditionalEnd:/\{\{\?\}\}/g,varname:"it",strip:!0,append:!0},doT.template=function(e,t,n){t=t||doT.templateSettings;var r=t.append?"'+(":"';out+=(",i=t.append?")+'":");out+='",s=t.use||t.define?resolveDefs(t,e,n||{}):e;s=("var out='"+(t.strip?s.replace(/\s*<!\[CDATA\[\s*|\s*\]\]>\s*|[\r\n\t]|(\/\*[\s\S]*?\*\/)/g,""):s).replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(t.interpolate,function(e,t){return r+t.replace(/\\'/g,"'").replace(/\\\\/g,"\\").replace(/[\r\t\n]/g," ")+i}).replace(t.encode,function(e,t){return r+t.replace(/\\'/g,"'").replace(/\\\\/g,"\\").replace(/[\r\t\n]/g," ")+")"+".toString().replace(/&(?!\\w+;)/g, '&#38;').split('<').join('&#60;').split('>')"+".join('&#62;').split('"+'"'+"').join('&#34;').split("+'"'+"'"+'"'+")"+".join('&#39;').split('/').join('&#47;'"+i}).replace(t.conditionalEnd,function(e,t){return"';}out+='"}).replace(t.conditionalStart,function(e,t){var n="if("+t+"){";return"';"+n.replace(/\\'/g,"'").replace(/\\\\/g,"\\").replace(/[\r\t\n]/g," ")+"out+='"}).replace(t.evaluate,function(e,t){return"';"+t.replace(/\\'/g,"'").replace(/\\\\/g,"\\").replace(/[\r\t\n]/g," ")+"out+='"})+"';return out;").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/\r/g,"\\r").split("out+='';").join("").split("var out='';out+=").join("var out=");try{return new Function(t.varname,s)}catch(o){throw typeof console!="undefined"&&console.log("Could not create a template function: "+s),o}},doT.compile=function(e,t){return doT.template(e,null,t)},doT}(),selfClosing={area:1,base:1,basefont:1,br:1,col:1,frame:1,hr:1,img:1,input:1,link:1,meta:1,param:1},directProperties={className:"class",htmlFor:"for"},booleanProperties={checked:1,defaultChecked:1,disabled:1,multiple:1,selected:1},$node=function(){var e="<",t=">",n="</",r="/>",i=" ",s='="',o='"',u=r;if("document"in root){var a=document.createElement("div"),f=document.createElement("img");a.appendChild(f),a.innerHTML==="<img>"&&(u=t)}var l=function(e){var t="";return $each(e,function(e){if(e||e===0)t+=e}),t},c={init:function(){this.type="",this.attr={},this.children=[],this.children.toString=function(){return l(this)}},nodeType:1,append:function(e){return this.children.splice.apply(this.children,$flat(this.children.length,0,e)),this},set:function(e,t){if(e)if(!$isString(e)){var n=e;that=this,n.id&&(this.set("id",n.id),delete n.id),n.className&&(this.set("className",n.className),delete n.className),$each(n,function(e,t){that.set(t,e)})}else t?(e=directProperties[e]||e,booleanProperties[e]&&(t?t=e:delete this.attr[e]),this.attr[e]=t):delete this.attr[e];return this},toString:function(){var r=e+this.type;return $each(this.attr,function(e,t){e&&(r+=i+t+s+e+o)}),selfClosing[this.type]?r+u:r+t+this.children+n+this.type+t}};return c.appendChild=c.append,c.removeAttribute=c.setAttribute=c.set,function(e){var t=$new(c);return t.type=e||"div",t}}(),useDocument=root.document,emptyString="",$doc={hasRealDom:function(){return!!root.document},usesRealDom:function(){return useDocument},useRealDom:function(e){return useDocument=root.document?e:!1,useDocument},createTextNode:function(e){return useDocument?document.createTextNode(e):e+emptyString},createElement:function(e){return useDocument?document.createElement(e):$node(e)}},$el=function(){function s(e,s,o){var u=t[s],a=!o&&o!==i;u&&!a?e[u]=a?r:r+o:n[s]?o&&e.setAttribute(s,s):a?e.removeAttribute(s):e.setAttribute(s,r+o)}function u(e,t){$isArray(t)||(t=[t]),$each(t,function(t){f(e,t)})}function f(e,t){if(t||t===0)t&&t.pop?u(e,t):!t||t.nodeType!==1?(a.innerHTML=t,$each(a.childNodes,function(t){e.appendChild(t)})):e.appendChild(t)}function c(e,t,n){if(!e)throw new Error("selector required");var r,i,o,a,f,c,h,p,d,v,m;t&&(t.charAt||t.pop)&&(n=t,t={}),i=e.split(l),d=i[0],a=i.length;if(a>2){r={};for(c=1,h=2,p=a;h<p;c+=2,h+=2)o=i[h],i[c]==="#"?v=o:m=m?m+" "+o:o;if(v||m)t&&$mixin(r,t),v&&(r.id=v),m&&(r.className=t&&t.className?m+" "+t.className:m),t=r}return v=m=null,d=d||"div",f=$doc.createElement(d),useDocument?(t&&(t.id&&s(f,"id",t.id),t.className&&s(f,"class",t.className),$each(t,function(e,t){s(f,t,e)})),n&&u(f,n)):(t&&f.set(t),n&&f.append(n)),f}var e=this,t={"class":"className",className:"className",defaultValue:"defaultValue","for":"htmlFor",value:"value"},n={checked:1,defaultChecked:1,disabled:1,multiple:1,selected:1,autoplay:1,controls:1,loop:1},r="",i=0,o="pop";if(e.document)var a=document.createElement("div");var l=/(#|\.)/;return c}(),$isSelector=function(){function s(r){if(r&&!r.charAt)return!1;if(r.safe)return!1;if(r.indexOf(" ")>-1||r.indexOf("<")>-1)return!1;var i=r.split(n),s=i[0].toLowerCase();if(s.length>e||!(s in t))return!1;var o=i.length,u="",a="",f,l,c,h,p;if(o>2)for(f=1,l=2,c=o;l<c;f+=2,l+=2)h=i[l],p=i[f],p==="#"?u=h:a=a?a+" "+h:h;return{tag:s,id:u,className:a}}var e=0,t={},n=/(#|\.)/,r=/\s+/,i="a abbr acronym address applet area article aside audio b base basefont bdi bdo big							blockquote body br button canvas caption center cite code col colgroup command datalist							dd del details dfn dir div dl dt em embed fieldset figcaption figure font footer							form frame frameset h1 h2 h3 h4 h5 h6 head header hgroup hr html i iframe img input ins keygen kbd							label legend li link map mark menu meta meter nav noframes noscript object ol optgroup							option output p param pre progress q rp rt ruby s samp script section select small source							span strike strong style sub summary sup table tbody td textarea tfoot th thead time title							tr track tt u ul var video wbr";return $each(i.split(r),function(n){e=Math.max(e,n.length),t[n]=1}),s.addTag=function(n){e=Math.max(e,n.length),t[n]=one},s}(),$dom=function(){function e(t,n){if(!t||!t.pop)t=$slice(arguments),n=null;var r=[],i,s,o,u,a,f,l,c,h=1,p,d,v,m=t.length;for(v=0;v<m;v++){a=t[v],p=d,d=h+"-"+$typeof(a);switch(d){case"1-string":u=n||$isSelector(a),u?(i=u.tag,l=u.id,c=u.className,u=n=null,s={},l&&(s.id=l),c&&(s.className=c),v===m-1&&r.push($el(i,s)),h=2):r.push(a);break;case"1-element":r.push(a);break;case"1-function":r=r.concat(a());break;case"1-array":m+=a.length-1,t.splice.apply(t,[v,1].concat(a)),v--;break;case"2-object":var g;$each(a,function(e){return g=e,"break"});if(g&&(g.pop||$isSelector(g))){o=e($values(a)),r.push($el(i,s,o)),h=1;break}$each(a,function(e,t){s[t]=e}),l&&(s.id=l),c&&(s.className=a.className?c+" "+a.className:c),v===m-1&&r.push($el(i,s)),l=c=null,h=3;break;case"2-number":case"3-number":a+="";case"2-string":case"3-string":case"3-element":u=n||$isSelector(a),u||selfClosing[i]?(r.push($el(i,s)),n=u,v--):r.push($el(i,s,a)),h=1;break;case"2-array":case"3-array":if(selfClosing[i])throw new Error("Can not add children to "+i);o=e(a),r.push($el(i,s,o)),h=1;break;case"3-function":r.push($el(i,s)),r=r.concat(a()),h=1;break;default:var y="$dom: No such step + type combination: "+d+" - previous was "+p+", "+a;throw console.log(y,a,r),new TypeError(y)}}return o=s=null,r.toString=function(){return this.join("")},r}return e}(),parts={};$part.drop=function(e){delete parts[e]},$part.dropAll=function(e){parts={}};var $parts=$part,jsre=/^http|^\/|^\.|\.js$/i,$escapeHTML=function(){var e=/&(?!\w+;|#\d+;|#x[\da-f]+;)/gi,t="&amp;",n=/</g,r="&lt;",i=/>/g,s="&gt;",o=/"/g,u="&quot;",a=/'/g,f="&#x27;",l=/\//g,c="&#x2F;";return function(l){return typeof l=="string"&&(l=new String(l.replace(e,t).replace(n,r).replace(i,s).replace(o,u).replace(a,f)),l.safe=!0),l}}(),$bindEventSpec=function(){var e=/^(\S+)\s*(.*)$/;return function(t){var n,r,i;arguments.length==3?(n=arguments[0],r=arguments[1],t=arguments[2]):(n=t.node,r=t.events),i=t.id||"";if(!$isElement(n)||!r)throw console.log(n,r,t),new Error("invalid arguments");$(n).unbind(".delegateEvents"+i),$each(r,function(r,s){var o=s.match(e),u=o[1]+".delegateEvents"+i,a=o[2],f=$isFunction(r)?r:t[r],l;if(!$isFunction(f))throw console.log(f,r,s),new Error("No such callback "+r);l=function(e){f.call(this,e,t)},a===""?$(n).bind(u,l):$(n).on(u,a,l)})}}();loot.extend({$id:$id,$tmpl:$tmpl,$node:$node,$doc:$doc,$el:$el,$isSelector:$isSelector,$dom:$dom,$part:$part,$js:$js,$script:$js,$parts:$parts,$render:$render,$escapeHTML:$escapeHTML,$bindEventSpec:$bindEventSpec,$touchable:$touchable})}(),function(){function t(e,t){t=t||[];var n=this,r=t.length,i=t[0],s=r==1&&$isString(i)?!0:!1,o;if(s)return o=e[i],$isFunction(o)?o.call(e,n):o;if(r>1||$isArray(t[0])){var u={},a=r>1?t:t[0];return $each(a,function(t){t in e&&(o=e[t],u[t]=$isFunction(o)?o(n):o)}),u}return $map(e,function(t,r){return $isFunction(t)?e[r](n):t})}function n(e,t){for(var n in e)n in t?e[n]=t[n]:delete e[n]}function r(e,t,n,r){return n=$isString(n)?this[n]:n,$isFunction(n)?n.call(r,e,t):e}function i(e){var t=this.parseInput,n=this,i=$isArray(e)?[]:{};return t?($each(t,function(t,s){s in e?i[s]=r(e[s],s,t,n):s==="*"&&$each(e,function(e,s){i[s]=r(e,s,t,n)})}),$mixin(i,e)):e}function s(e){var t=this.parse,n=this;return t?t.call(n,e):e}function o(e,t,n){var r,i,s,o={},u=this.validate||{},a=this.defaults||{},f,l,c={},h="cannot set dynamic property ";typeof t=="string"?(s={},s[t]=n):s=t;for(i in s){if(!s.hasOwnProperty(i))continue;r=s[i],$isFunction(a[i])?c[i]=h+i:(f=u[i])&&r!==undefined?(f=$isFunction(f)?[f]:f,l={},$each(f,function(e,t){var n=e(r);n===!0&&(l[t]=n)}),$length(l)?c[i]=l:o[i]=r):o[i]=r}return $length(c)?this.tell("validationFailed",{passed:o,failed:c}):($extend(e,o),this.tell("change",o)),this}function u(r,a,f){var l=e[r],c=[],h=arguments;if(arguments.length===0)return e;if(r&&arguments.length===1&&l)return l;if(!(r&&$isString(r)&&!l))return new Error("Error: valid schema type required.");a=$copy(a||{}),a.defaults=a.defaults||{},a.validate&&$each(a.validate,function(e){if(!$isFunction(e))throw new Error("validator must be a function")});var p=$speak({type:r,spec:function(){return a},constructor:function(e){return this.newInstance(e)},drop:function(){this.dropInstances(),c=l=null,delete e[r],$clear(this,!0),u.tell("drop",{schema:r})},getInstances:function(){return c},dropInstances:function(e){var t=c;return e&&(t=$filter(c,e)),$each(t,function(e){e.drop()}),this},newInstance:function(e){var u=$copy(a.defaults),f=$speak($new(a)),l=a.drop;if(l&&!$isFunction(l))throw new Error("if drop is provided it must be a function");var h=$extend(f,{schema:r,get:function(){return t.call(this,u,$slice(arguments))},set:function(e,t){return o.call(this,u,e,t)},reset:function(){return n.call(this,u,a.defaults)},renew:function(){return d()},drop:function(){l&&l(),this.tell("drop",this),c.splice(c.indexOf(this),1),$clear(this,!0)}});e=i.call(h,e),e=s.call(h,e),$isString(e)||$mixin(u,e);var p=this,d=function(){return h.talksTo(p),c.push(h),h.tell("created",p),h};return d()}});e[r]=f?$make(p,f):p,u.tell("defined",{schema:r})}function a(t,n){var r=e[t];if(!arguments.length)return u();if(!t||!$isString(t)||!r)return null;if(!n||!!$isPlainObject(n))return r.newInstance(n)}function f(e,t,n){var r=u(),i=arguments.length;i===2&&(n=t,t="id");if(!i)return r;if(e in r){var s=r[e].getInstances(),o;return i>1?($each(s,function(e){e.get(t)==n&&(o=e)}),o):s}}function l(e){return e&&$isFunction(e.drop)&&$isString(e.type)&&e.getInstances&&e.newInstance}function c(e){return e&&$isFunction(e.drop)&&$isString(e.schema)&&e.set&&e.get}var e={};$speak(u),f.getInstanceCounts=function(){return $map(f(),function(e){return e.getInstances().length})},loot.extend({$schema:u,$define:u,$model:a,$models:f,$isSchema:l,$isModel:c})}(),function(){function t(n,r,i,s,o){var u=e[n],a=arguments,f=[];if(n&&arguments.length===1&&u)return u;if(n&&arguments.length===2&&u){var l=r;return u(l)}if($isString(n)&&!u){var c=function(e,t){var i,u,l,c,h,p,d=$speak({drop:function(){this.model&&this.unbindModel(),l&&$isFunction(l)&&l(),$(d.node).remove(),d.parentNode&&d.parentNode.removeChild(d.node),d.tell("drop"),$clear(this,!0)},update:function(){return u({},"update",d.model),this},draw:function(){return d.model&&d.update(d.model.get(),d.type,d.model),this},get:function(){return d.model.get.apply(d.model,$slice(arguments))},set:function(){return d.model.set.apply(d.model,$slice(arguments))},unbindModel:null,setModel:function(e,t){if(e&&e===this.model)return;this.unbindModel&&this.unbindModel();if(e&&!$isModel(e)&&!$isCollection(e))throw new Error("$view: model argument must be a $model or $collection");d.model=e;if($isCollection(e)){var n=/^change/,r=function(e,t,n){u(n,t,this)};this.unbindModel=function(){e.ignore&&e.ignore(r),this.model=null},d.model.listen(n,r)}else d.model&&(this.unbindModel=function(){e.ignore&&e.ignore(u),this.model=null},d.model.listen("change",u));t||this.update()}});if(r&&a.length===2&&$isObject(r)){var v=a[1];o=v.events,c=v.node,h=$isModel(e)?e:v.model,p=$isCollection(e)?e:v.collection,l=v.drop,s=v.template||v.render,$extend(d,v)}$isString(c)&&(c=$el(c)),$isString(h)&&(h=$model(h,e)),$isString(p)&&(p=$collections(p));if(!$isElement(c))throw new Error("$view: node must be a DOM node");if(h&&!$isModel(h)||p&&!$isCollection(p))throw new Error("$view: model argument must be a product of $model");d.type=n,d.id=$uniqueId(n+"View"),d.node=c;if($isString(s))i=$tmpl(s),u=function(e,t,n){return d.node.innerHTML=i(n.get()),d.node};else{if(!$isFunction(s))throw new Error("$view: template must be a template string or render function");var m;u=function(e,t,n){var r=s.call(d,n&&n.get(),e,d);return r&&($isElement(r)?(m?d.node.replaceChild(r,m):d.node.appendChild(r),m=r):d.node.innerHTML=r),d.node}}return d.setModel(p||h,!0),d.init&&$isFunction(d.init)&&d.init(t),o&&$bindEventSpec(d),$isPlainObject(d.listeners)&&$speak.util.bindListenerSpec(d,d.listeners),f.push(d),d.update(),d};return $mixin(c,{drop:function(){this.dropInstances(),f=u=null,delete e[n],$clear(this,!0),t.tell("drop",{constructor:n})},getInstance:function(e){return $find(this.getInstances(),function(t){return t.id===e})},getInstances:function(){return f},dropInstances:function(e){var t=f;return e&&(t=$filter(f,e)),$each(t,function(e){e.drop()}),this}}),e[n]=c,c}throw console.log(arguments),new Error("Invalid Arguments!")}function n(t,n){return t&&t in e?t&&n?e[t].getInstance(n):e[t].getInstances():arguments.length?undefined:e}function r(e){return e&&e.drop&&$isFunction(e.drop)&&e.node&&e.model}function i(t){return $contains(e,t)}var e={};loot.extend({$view:t,$views:n,$isView:r,$isViewConstructor:i})}(),function(){function n(n,r){var i=r.view,s=r.schema;if(n in t)throw new Error("collection name "+n+" already in use;");var o=$speak($extend($new(e),r));o.items=[];if(i){i=$isString(i)?$view(i):i;if(!$isViewConstructor(i))throw new Error("$collection: Invalid view type or constructor function");o.view=i,o.draw=r.draw?r.draw:o.draw}else if(s){delete o.draw,s=$isString(s)?$schema(s):s;if(!$isSchema(s))throw new Error("$collection: Invalid schema type or constructor function ");o.schema=s}return $isString(o.node)&&(o.node=$el(o.node)),o.events&&$isElement(o.node)&&$bindEventSpec(o),$isPlainObject(o.listeners)&&$bindListenerSpec(o),$isFunction(o.init)&&o.init(),t[n]=o,o.listen("*",function(e,t){t!=="change"&&t.match("change")&&o.tell("change",{msg:e,type:t})}),o}function r(e){return e?t[e]:t}function i(e){return!!(e&&e.add&&e.items&&e.groupBy&&e.pop)}var e={items:!0,length:function(){return this.items.length},isSortedBy:"",isGroupedBy:"",skip:0,limit:10,filter:null,isReversed:!1,add:function(e,t,n){var r=$isArray(e)?e:[e],i=this;return $each(r,function(e){i.view?$isModel(e)?e=i.view(e,i):e=$isView(e)?e:i.view(e,i):i.schema&&(e=$isModel(e)?e:i.schema.newInstance(e)),$isSpeaker(e)&&i.listensTo(e),i.items.push(e)}),n||this.order(),t||this.tell("change:add",r),this},push:function(e){return this.add(e),this},order:function(){return this.sortIterator?this.items=$sortBy(this.items,this.sortIterator):this.isSortedBy&&this.sortBy(this.isSortedBy),this.groupByIterator&&(this.items=$groupBy(this.items,this.groupByIterator)),this.isReversed&&this.items.reverse(),this},set:function(e){return this.items=[],this.add(e,"silent",!0),this.order(),this.tell("change:set",e),this},get:function(e,t){if($isNumber(e))return this.items[e];if(arguments.length===2&&$isString(e)){var n,r;return $each(this.items,function(i){r=i.model||i;if(r.get(e)==t)return n=i,$each.break}),n}return this.items},getAll:function(e){return $map(this.items,function(t){return t.get(e)})},getValues:function(e,t){var n,r=this.items.length;return $isNumber(e)&&(e=e<0?(r+e)%r:e,n=this.items[e]),n?$isFunction(val.get)?n.get(t):null:$map(this.items,function(e){return $isFunction(e.get)?e.get(t):e})},getGroupSortIterator:function(e){return function(t){return t?$isModel(t.model)?t.model.get()[e]:$isFunction(t.get)?t.get()[e]:t[e]:!1}},sortBy:function(e){var t=$isFunction(e)?e:this.getGroupSortIterator(e);return this.isSortedBy=e,this.sortIterator=t,this.items=$sortBy(this.items,t),this.isReversed&&this.items.reverse(),this.tell("change:sortBy"),this},groupBy:function(e){var t=$isFunction(e)?e:this.getGroupSortIterator(e);return this.isGroupedBy=e,this.groupByIterator=t,this.items=$groupBy(this.items,t),this.tell("change:groupBy"),this},reverse:function(){return this.isReversed=!this.isReversed,this.items.reverse(),this.tell("change:reverse"),this},drop:function(e){var t=e?this.items.indexOf(e):this.items.length-1;if(t>-1)var n=this.items.splice(t,1)[0];return this.tell("change:drop",n),n&&n.drop(),this},pop:function(){var e=this.items.pop(),t=$isModel(e)?e.get():e?e.model:null;return t=$isModel(t)?t.get():e,this.tell("change:pop",t),t},dropAll:function(){return $map(this.items,function(e){e.drop&&e.drop()}),this.items=[],this.tell("change:dropAll"),this},draw:function(){if($isElement(this.node)){var e=[];$each($slice(this.items,this.skip,this.skip+this.limit),function(t){t&&$isElement(t.node)&&e.push(t.node)},this),this.node.innerHTML="",$(this.node).append(e)}return this},destroy:function(){this.ignore(),$(this.node).remove().unbind(),this.dropAll(),delete t[this.name]}},t={};loot.extend({$collection:n,$collections:r,$isCollection:i})}(),function(e){function o(e){var n;for(var r=0,i=t.length;r<i;r++){n=t[r];if(n.name==e)return n}if(n=l(e))return n;throw new Error('$routes: route "'+e+'" was not found.')}function u(e,t){var n=e.pathPattern;if(e.defaults)for(var r in e.defaults){if(t&&t[r]!==undefined)continue;var i=new RegExp("\\:"+r,"gi");n=n.replace(i,"")}if(t)for(var r in t){var s=t[r],o=encodeURIComponent(s),i=new RegExp("\\:"+r,"gi");n=n.replace(i,o)}return n.replace(/\/+$/,"")}function a(e,t){var n=$new(t.defaults),r=e.split("/");for(var i=0,s,o;i<r.length&&(s=t.segments[i]);i++)if((o=/:(\w+)/.exec(s))!=null){if(r[i]==""&&n[o[1]])continue;n[o[1]]=r[i]}return n}function f(e){var t=e.pathPattern.replace(/\/+$/,"").split("/"),n=e.defaults,r=["^"];for(var i=0,s,o;(s=t[i])!==undefined;i++)if((o=/:(\w+)/.exec(s))!=null){var u=o[1];r.push((i>0?"(/":"")+"([^/]+)"+(i>0?")":"")),n&&n[u]!==undefined&&r.push("?")}else r.push((i>0?"/":"")+s);return r.push("$"),new RegExp(r.join(""),"i")}function l(e){for(var n=0,r;r=t[n];n++){r.regexp||(r.regexp=f(r),r.segments=r.pathPattern.split("/"));var i=r.regexp.test(e);if(i){var s=a(e,r);return $extend({},r,{values:s})}}return null}function c(){var e=window.location.hash;if(n&&r==e)return n;if(!s)return;e=e.replace(/^#/,"").replace(/\/+$/,"");var t=l(e);if(t){var i=a(e,t);return $extend({},t,{values:i})}}function h(){if(r==window.location.hash)return;var e=c();e&&e.callback&&(n=e,r=window.location.hash,e.callback(e.values))}function p(e,n,r,i){if(arguments.length===2){if(!$isFunction(n))throw new Error("incomplete arguments");t.push({name:e,pathPattern:e,callback:n,defaults:i})}else t.push({name:e,pathPattern:n,callback:r,defaults:i})}function d(e){return e?t[e]:t}function v(e,t){var n;arguments.length?n=o(e):n=c();var r="#"+u(n,t||n.values);window.location.hash!==r?(console.log("set hash"),window.location.hash=r):(console.log("same hash"),h())}function g(e){var t=$extend(m,e);if(!e||!e.routes)throw new Error("routes property required");return $each(e.routes,function(e,n){p(n,function(n){if($isString(e))e=t[e];else if(!$isFunction(e))throw new Error("invalid route callback value");e.apply(t,$slice(arguments))})}),$isPlainObject(t.listeners)&&$bindListenerSpec(t),t}var t=[],n,r,i,s=!1,m=$speak({getCurrentRoute:function(){return n},getCurrentPath:function(){return r}});"onhashchange"in e&&$(window).on("hashchange",h),s=!0,loot.extend({$route:p,$router:g,$routes:d,$loadRoute:v,$currentRoute:c})}(this);